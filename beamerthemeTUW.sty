%%
% @file beamerthemeTUW.sty
% @date 30.08.2016
% @author OSUE-Team 2010, OSUE-Team 2016
%
% @brief Beamer LaTeX template matching the corporate design of TU Wien.
%%

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{beamerthemeTUW}[2016/08/30 Beamer template that fits the TU Wien corporate design (adopted styles from powerpoint presentation template)]

\RequirePackage{graphicx}
\RequirePackage{tikz}

\def\beamer@viennaPlain{plain}
\def\beamer@viennaSidebar{sidebar}
\def\beamer@viennaHelvetica{helvetica}

%%% options
% The user may choose helvetica when the TU Wien font is not installed.
\DeclareOptionBeamer{font}{\def\beamer@viennaFont{#1}}
% Another outer theme may be chosen, however it won't fit the CD of TU Wien (in
% color or style).
\DeclareOptionBeamer{outer}{\def\beamer@viennaOuter{#1}}
\ExecuteOptionsBeamer{outer=plain} % default style
\ProcessOptionsBeamer

\ifx\beamer@viennaFont\beamer@viennaHelvetica
\RequirePackage{helvet}
\else
\RequirePackage{din}
\RequirePackage{frutiger}
\fi

\mode<presentation>

%%% colors
% For some reason the logo is not in TU-blue (0,102,153). The powerpoint
% presentation has TU-blue as background and the logo with a different color
% (doesn't look nice). We align the TU-blue to the logo, like in the CD manual.
\definecolor{TUWblue}{RGB}{0,116,178}
\definecolor{TUWgray}{RGB}{102,102,102}
\definecolor{IceBlue}{RGB}{222,231,236}

\def\TUWblue{TUWblue}
\def\TUWgray{TUWgray}
\def\IceBlue{IceBlue}
\def\TUWlightblue{TUWblue!20!white}
\def\TUWmediumblue{TUWblue!45!white}
\def\TUWdarkblue{TUWblue!70!black}
\def\alertred{red!50!black}

% content page
\setbeamercolor{normal text}{fg=black,bg=white}
\setbeamercolor{alerted text}{fg=\alertred}
\setbeamercolor{structure}{fg=\TUWblue}
\setbeamercolor{frametitle}{fg=black}

\setbeamercolor{palette primary}{fg=\TUWdarkblue,bg=\TUWlightblue}
\setbeamercolor{palette secondary}{fg=\TUWblue!50!black,bg=\TUWmediumblue}
\setbeamercolor{palette tertiary}{fg=white,bg=\TUWblue}

\setbeamercolor{section in toc}{parent=normal text}
\setbeamercolor{subsection in toc}{parent=section in toc}

\setbeamercolor{block title}{fg=white, bg=\TUWblue}
\setbeamercolor{block title example}{fg=white, bg=\TUWblue}
\setbeamercolor{block title alerted}{fg=white, bg=\alertred}
\setbeamercolor{block body}{bg=\IceBlue}
\setbeamercolor{block body example}{parent=block body}
\setbeamercolor{block body alerted}{parent=block body, fg=\alertred}

\setbeamercolor{title in head/foot}{fg=\TUWblue}
\setbeamercolor{page number in head/foot}{fg=\TUWblue}
\setbeamercolor{footline}{fg=\TUWblue}

% color difference of plain and other outer styles
\ifx\beamer@viennaOuter\beamer@viennaPlain
% plain style - this is the CD of TU Wien
% title page
\setbeamercolor{title}{fg=white}
\setbeamercolor{subtitle}{fg=white}
\setbeamercolor{author}{fg=white}
\setbeamercolor{institute}{fg=white}
\setbeamercolor{date}{fg=white}
% content page
\setbeamercolor{headline}{fg=black}
\else
% other outer styles (e.g., sidebar)
% title page
\setbeamercolor{title}{fg=\TUWgray}
\setbeamercolor{subtitle}{fg=\TUWgray}
\setbeamercolor{author}{fg=black}
\setbeamercolor{institute}{fg=black}
\setbeamercolor{date}{fg=black}
% content page
\setbeamercolor{headline}{fg=\TUWgray}
\fi

% sidebar
\setbeamercolor{sidebar}{bg=\TUWblue,fg=white}
\setbeamercolor{palette sidebar primary}{fg=\TUWdarkblue,bg=\TUWlightblue}
\setbeamercolor{palette sidebar secondary}{fg=\TUWdarkblue,bg=\TUWlightblue}
\setbeamercolor{palette sidebar tertiary}{fg=white}
\setbeamercolor{title in sidebar}{fg=white}
\setbeamercolor{section in sidebar}{fg=\TUWdarkblue}
\setbeamercolor{section in sidebar shaded}{fg=white}
\setbeamercolor{subsection in sidebar}{fg=\TUWdarkblue}
\setbeamercolor{subsection in sidebar shaded}{fg=white}

%%% fonts

% font family
\ifx\beamer@viennaFont\beamer@viennaHelvetica
\setbeamerfont{title}{series*=b}
\setbeamerfont{author}{series*=m}
\setbeamerfont{institute}{series*=m}
\setbeamerfont{date}{series*=m}
\setbeamerfont{frametitle}{series*=b}
\setbeamerfont{headline}{series*=b}
\setbeamerfont{footline}{series*=b}
\else
\setbeamerfont{title}{family*=din}
\setbeamerfont{author}{family*=din}
\setbeamerfont{institute}{family*=din}
\setbeamerfont{date}{family*=din}
\setbeamerfont{frametitle}{family*=din}
\setbeamerfont{headline}{family*=din}
\setbeamerfont{footline}{family*=din}
\fi

% font size difference of plain and other outer styles
\ifx\beamer@viennaOuter\beamer@viennaPlain
% plain style - this is the CD of TU Wien
\setbeamerfont{title}{size=\huge}
\setbeamerfont{author}{size=\normalsize}
\setbeamerfont{institute}{size=\normalsize}
\setbeamerfont{date}{size=\normalsize}
\setbeamerfont{frametitle}{size=\large}
\setbeamerfont{headline}{size=\scriptsize}
\setbeamerfont{footline}{size=\scriptsize}
\else
% other outer styles (e.g., sidebar)
% keep defaults
\fi

\setbeamerfont{section in toc}{parent=normal text}
\setbeamerfont{subsection in toc}{parent=section in toc}

%%% outer
\setbeamersize{text margin left=0.09\paperwidth}
\setbeamersize{text margin right=0.12\paperwidth}
\beamertemplatenavigationsymbolsempty

\ifx\beamer@viennaOuter\beamer@viennaPlain
% plain style - this is the CD of TU Wien

% background
\setbeamertemplate{background}{
  \begin{tikzpicture}
    \useasboundingbox (0,0) rectangle(\the\paperwidth,\the\paperheight);
    % title page
    \fill[white] (0,0) rectangle (\the\paperwidth,\the\paperheight);
    \fill[\TUWblue, rounded corners=0.5cm] (-1cm,-1cm) rectangle (0.965\paperwidth,0.68\paperheight);
    \node[anchor=south west] (logo) at (0.02\paperwidth,0.76\paperheight) {\includegraphics[width=0.4\paperwidth]{TU_Logo}};
    % content page
    \ifnum\thepage>1\relax%
    \fill[\IceBlue] (0,0) rectangle (\the\paperwidth,\the\paperheight);
    \fill[white, rounded corners=0.5cm] (-1cm,-1cm) rectangle(0.97\paperwidth,0.91\paperheight);
    \node[anchor=south west] (logo) at (0.02\paperwidth,0.915\paperheight) {\includegraphics[width=0.04\paperwidth]{TU_Signet}};
    \fi
  \end{tikzpicture}
}

% title page
\setbeamertemplate{title page}{
  \vskip 4.5cm%
  \begin{beamercolorbox}[leftskip=1.5cm]{title}%
    \usebeamerfont{title}\inserttitle%
  \end{beamercolorbox}%
  \vskip 0.5cm%
  \begin{beamercolorbox}[leftskip=1.5cm]{subtitle}
    \usebeamerfont{subtitle}\insertsubtitle%
  \end{beamercolorbox}
  \vskip 1.3cm%
  \begin{beamercolorbox}[leftskip=1.5cm]{author}
    \usebeamerfont{author}\insertauthor%
  \end{beamercolorbox}
  \begin{beamercolorbox}[leftskip=1.5cm]{date}
    \usebeamerfont{date}\insertdate%
  \end{beamercolorbox}
  \vfill
}

\setbeamertemplate{footline}[page number]

\else\ifx\beamer@viennaOuter\beamer@viennaSidebar
% sidebar style
\useoutertheme[height=0pt]{\beamer@viennaOuter}
\else
\useoutertheme{\beamer@viennaOuter}
\fi\fi % if outer=TUW plain or if outer=sidebar

%%% inner
\setbeamertemplate{section in toc}[square]
\setbeamertemplate{subsection in toc}[square]

% blocks
\setbeamertemplate{blocks}[rounded]
\pgfdeclareverticalshading{bmb@transition}{\the\paperwidth}{color(0pt)=(\IceBlue); color(3.0pt)=(\IceBlue)}

\setbeamercovered{transparent}


\hypersetup{colorlinks=true,linkcolor=fg,urlcolor=\TUWblue}

\mode<all>
